
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Making great Node.js modules with CoffeeScript - Nick Desaulniers</title>
  <meta name="author" content="Nick Desaulniers">

  
  <meta name="description" content="Node.js
is a great runtime for writing applications in JavaScript, the language
I primarily develop in.
CoffeeScript
is a programming language that &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://nickdesaulniers.github.io/blog/2013/08/28/making-great-node-dot-js-modules-with-coffeescript">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Nick Desaulniers" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at https://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36993986-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Nick Desaulniers</a></h1>
  
    <h2>The enemy's gate is down</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:nickdesaulniers.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/publications">Publications</a></li>
  <li><a href="/talks">Talks</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Making Great Node.js Modules With CoffeeScript</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-28T10:51:00-07:00" pubdate data-updated="true">Aug 28<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><a href="http://nodejs.org/">Node.js</a>
is a great runtime for writing applications in JavaScript, the language
I primarily develop in.
<a href="http://coffeescript.org/">CoffeeScript</a>
is a programming language that compiles
to JavaScript.  Why would we write a reusable piece of code, a
<a href="http://nodejs.org/api/modules.html">module</a>
, in
CoffeeScript?  CoffeeScript is a very high level language and
<a href="http://railscasts.com/episodes/267-coffeescript-basics">beautifully brings together</a>
my favorite aspects of JavaScript,
Ruby, and Python.  In this tutorial, I&rsquo;ll show you how I create reusable open
source modules for Node.js from CoffeeScript, which is something I recently
discovered while creating a
<a href="https://github.com/nickdesaulniers/javascript-playlist-parser">playlist parser module</a>.
The point is to focus on how to turn a quick hack into a nicely laid
out Node.js module.</p>

<p>The steps are as follows:</p>

<ol>
<li>Turn an idea into a git repo.</li>
<li>Add directory structure.</li>
<li>Split library functions from testing.</li>
<li>Add a Build script.</li>
<li>Create node module.</li>
<li>Add LICENSE and README.</li>
<li>Publish.</li>
</ol>


<p>First thing&rsquo;s first, we have to have an idea.  It doesn&rsquo;t have to be
revolutionary, just do one thing and do it well.  That is the first rule of
<a href="http://www.faqs.org/docs/artu/ch01s06.html">UNIX <del>fightclub</del> philosophy</a>,
which resonates well within
<a href="http://blog.izs.me/post/48281998870/unix-philosophy-and-node-js">the Node.js community</a>.
When I&rsquo;m hacking on
something, I start out with a single file to test something out.  Then I
progressively refine the example until it&rsquo;s something reusable.  That way, I
can reuse it, others can reuse it, others can learn from it, and the world can
be a better place.</p>

<p>For this tutorial, I&rsquo;ll show you my process for creating a binding for
<a href="http://nanomsg.org/index.html">nanomsg</a>,
the latest scalability protocol library from the creator of
<a href="http://zeromq.org/">ZeroMQ</a>,
<a href="http://250bpm.com/">Martin SÃºstrik</a>.
I had played with ZeroMQ in the past and thought that it was really
awesome, and I was excited to see a new library from it&rsquo;s creator, based on C,
since I also really enjoyed his post on why he
<a href="http://250bpm.com/blog:4">shouldn&rsquo;t have written it in C++</a>.</p>

<p>So messing around real quick, let&rsquo;s make sure we have node up to date.  I like
to use
<a href="https://github.com/creationix/nvm">nvm</a>
and the latest stable minor version of node (stable versions have
even minor patch numbers where versions are in the format <code>major.minor.patch</code>,
so v0.11.0 is unstable).  <code>node -v</code> &ndash;> v0.10.17</p>

<p>Then I need to download and install the library that I&rsquo;ll be dynamically
linking to, build, and install it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>curl -O http://download.nanomsg.org/nanomsg-0.1-alpha.zip &amp;&amp; \
</span><span class='line'>unzip nanomsg-0.1-alpha.zip &amp;&amp; \
</span><span class='line'>cd nanomsg-0.1-alpha &amp;&amp; \
</span><span class='line'>mkdir build &amp;&amp; \
</span><span class='line'>cd build &amp;&amp; \
</span><span class='line'>../configure &amp;&amp; \
</span><span class='line'>make &amp;&amp; \
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll use
<a href="https://github.com/rbranson/node-ffi">node&rsquo;s FFI module</a>
to interface with the dynamically linked library,
because it&rsquo;s easier to write bindings than using
<a href="http://nodejs.org/api/addons.html">native addons</a>,
and
<a href="https://github.com/rvagg/node-addon-examples/blob/master/README.md#compatibility-notes">v8&rsquo;s API has recently changed causing some headaches for native extensions</a>.</p>

<p><code>npm install ffi</code></p>

<p>We&rsquo;ll be writing the example in CoffeeScript.</p>

<p><code>npm install -g coffee-script</code></p>

<p>Now to mess around we can create main.coffee based on
<a href="https://github.com/250bpm/cppnanomsg/blob/9becc3d5116ab33a7d2c5f06d68a8fea1b781194/binding.cpp#L29">the C++ binding&rsquo;s example</a>:</p>

<figure class='code'><figcaption><span>main.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">ffi = </span><span class="nx">require</span> <span class="s">&#39;ffi&#39;</span>
</span><span class='line'><span class="nv">assert = </span><span class="nx">require</span> <span class="s">&#39;assert&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">AF_SP = </span><span class="mi">1</span>
</span><span class='line'><span class="nv">NN_PAIR = </span><span class="mi">16</span>
</span><span class='line'>
</span><span class='line'><span class="nv">nanomsg = </span><span class="nx">ffi</span><span class="p">.</span><span class="nx">Library</span> <span class="s">&#39;libnanomsg&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nv">nn_socket: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span> <span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_bind: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;string&#39;</span> <span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_connect: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;string&#39;</span> <span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_send: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;pointer&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_recv: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;pointer&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_errno: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[]]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># test</span>
</span><span class='line'><span class="nv">s1 = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_socket</span> <span class="nx">AF_SP</span><span class="p">,</span> <span class="nx">NN_PAIR</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">s1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;s1: &#39;</span> <span class="o">+</span> <span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_errno</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_bind</span> <span class="nx">s1</span><span class="p">,</span> <span class="s">&#39;inproc://a&#39;</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;bind&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">s2 = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_socket</span> <span class="nx">AF_SP</span><span class="p">,</span> <span class="nx">NN_PAIR</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">s2</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;s2: &#39;</span> <span class="o">+</span> <span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_errno</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_connect</span> <span class="nx">s2</span><span class="p">,</span> <span class="s">&#39;inproc://a&#39;</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;connect&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">msg = </span><span class="k">new</span> <span class="nx">Buffer</span> <span class="s">&#39;hello&#39;</span>
</span><span class='line'><span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_send</span> <span class="nx">s2</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;send&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">recv = </span><span class="k">new</span> <span class="nx">Buffer</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span>
</span><span class='line'><span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_recv</span> <span class="nx">s1</span><span class="p">,</span> <span class="nx">recv</span><span class="p">,</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;recv&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">is</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="s">&#39;received message did not match sent&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>coffee main.coffee</code> &ndash;> hello</p>

<p>This quick example shows that we have something working.  Currently our working
directory should look like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>tree -L 2
</span><span class='line'>.
</span><span class='line'>âââ main.coffee
</span><span class='line'>âââ node_modules
</span><span class='line'>    âââ ffi
</span><span class='line'>
</span><span class='line'>2 directories, 1 file
</span></code></pre></td></tr></table></div></figure>


<h2>Turn an idea into a git repo</h2>

<p>Next up is to create a repository using a version control system like
<a href="http://git-scm.com/">git</a> and
start saving our work.
<a href="http://www.codinghorror.com/blog/2008/08/check-in-early-check-in-often.html">Check in early, check in often</a>.</p>

<p>Let&rsquo;s add a .gitignore so that were not adding files that really don&rsquo;t need to
be committed.  The node_modules folder is unnecessary because when this node
module is installed, its dependencies will be recursively installed, so
there&rsquo;s no need to commit them to source control.  The swap files are because I
use
<a href="http://www.vim.org/">vim</a>
and I accidentally commit the swap files from open buffers all the time
like a noob.</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>node_modules/
</span><span class='line'>*.swp
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s turn this into a git repo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>git init &amp;&amp; \
</span><span class='line'>git add . &amp;&amp; \
</span><span class='line'>git commit -am âinitial commitâ
</span></code></pre></td></tr></table></div></figure>


<p>Up on github, let&rsquo;s <a href="https://github.com/new">create an uninitialized repo</a>
and push to it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>git remote add origin git@github.com:nickdesaulniers/node-nanomsg.git &amp;&amp; \
</span><span class='line'>git push -u origin master
</span></code></pre></td></tr></table></div></figure>


<p>So we
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/19211e7520de9384a0d5b0ce4c08a623c4f2e0b9">have</a>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>tree -L 2 -a
</span><span class='line'>.
</span><span class='line'>âââ .gitignore
</span><span class='line'>âââ main.coffee
</span><span class='line'>âââ node_modules
</span><span class='line'>    âââ ffi
</span><span class='line'>
</span><span class='line'>2 directories, 2 files
</span></code></pre></td></tr></table></div></figure>


<h2>Add directory structure</h2>

<p>Now that we have our repo under version control, let&rsquo;s start adding some
structure. Let&rsquo;s create
<code>src/</code>, <code>lib/</code>, and <code>test/</code> directories.  Our CoffeeScript will live in
<code>src/</code>, compiled JavaScript will be in <code>lib/</code>, and our test code will be in
<code>test/</code>.</p>

<p><code>mkdir src lib test</code></p>

<h2>Split library functions from testing</h2>

<p>Now let&rsquo;s move a copy of <code>main.coffee</code> into <code>src/</code> and one into <code>test/</code>.  We
are going to split the library definition away from the testing logic.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>cp main.coffee test/test.coffee &amp;&amp; \
</span><span class='line'>git add test/test.coffee &amp;&amp; \
</span><span class='line'>git mv main.coffee src/nanomsg.coffee
</span></code></pre></td></tr></table></div></figure>


<p>This way <code>git status</code> tells us:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># On branch master
</span><span class='line'># Changes to be committed:
</span><span class='line'>#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)
</span><span class='line'>#
</span><span class='line'># renamed:    main.coffee -&gt; src/nanomsg.coffee
</span><span class='line'># new file:   test/test.coffee
</span><span class='line'>#
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s edit src/main.coffee to look like:</p>

<figure class='code'><figcaption><span>src/main.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">ffi = </span><span class="nx">require</span> <span class="s">&#39;ffi&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">exports = module.exports = </span><span class="nx">ffi</span><span class="p">.</span><span class="nx">Library</span> <span class="s">&#39;libnanomsg&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nv">nn_socket: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span> <span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_bind: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;string&#39;</span> <span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_connect: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;string&#39;</span> <span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_send: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;pointer&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_recv: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;pointer&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;int&#39;</span><span class="p">]]</span>
</span><span class='line'>  <span class="nv">nn_errno: </span><span class="p">[</span> <span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="p">[]]</span>
</span><span class='line'>
</span><span class='line'><span class="nv">exports.AF_SP = </span><span class="mi">1</span>
</span><span class='line'><span class="nv">exports.NN_PAIR = </span><span class="mi">16</span>
</span></code></pre></td></tr></table></div></figure>


<p>and edit the tests to:</p>

<figure class='code'><figcaption><span>test/test.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">assert = </span><span class="nx">require</span> <span class="s">&#39;assert&#39;</span>
</span><span class='line'><span class="nv">nanomsg = </span><span class="nx">require</span> <span class="s">&#39;../lib/nanomsg.js&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span> <span class="nx">AF_SP</span><span class="p">,</span> <span class="nx">NN_PAIR</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">nanomsg</span>
</span><span class='line'>
</span><span class='line'><span class="nv">s1 = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_socket</span> <span class="nx">AF_SP</span><span class="p">,</span> <span class="nx">NN_PAIR</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">s1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;s1: &#39;</span> <span class="o">+</span> <span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_errno</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_bind</span> <span class="nx">s1</span><span class="p">,</span> <span class="s">&#39;inproc://a&#39;</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;bind&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">s2 = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_socket</span> <span class="nx">AF_SP</span><span class="p">,</span> <span class="nx">NN_PAIR</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">s2</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;s2: &#39;</span> <span class="o">+</span> <span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_errno</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_connect</span> <span class="nx">s2</span><span class="p">,</span> <span class="s">&#39;inproc://a&#39;</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;connect&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">msg = </span><span class="k">new</span> <span class="nx">Buffer</span> <span class="s">&#39;hello&#39;</span>
</span><span class='line'><span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_send</span> <span class="nx">s2</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;send&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">recv = </span><span class="k">new</span> <span class="nx">Buffer</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span>
</span><span class='line'><span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_recv</span> <span class="nx">s1</span><span class="p">,</span> <span class="nx">recv</span><span class="p">,</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'><span class="nx">assert</span> <span class="nx">ret</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;recv&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">assert</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">is</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="s">&#39;received message did not match sent&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice how in the test we&rsquo;re including the compiled javascript from <code>lib/</code>
which doesn&rsquo;t exist yet?  If you try running <code>coffee test/test.coffee</code> it
should crash.  Let&rsquo;s make the compiled version.
<code>coffee -o lib -c src/nanomsg.coffee</code></p>

<p>Once the compiled lib exists, we can run our tests with
<code>coffee test/test.coffee</code> and shouldn&rsquo;t see any errors.</p>

<p>Now we should have a little more order, let&rsquo;s
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/3e3e3918971e2eddbe95e91e0c3cf32e7f8becba">commit</a>.
Hold off on adding
<code>lib/</code> to version control, I&rsquo;ll explain why in a bit.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>tree -L 2 -C -a -I &#39;.git&#39;
</span><span class='line'>.
</span><span class='line'>âââ .gitignore
</span><span class='line'>âââ lib
</span><span class='line'>âÂ Â  âââ nanomsg.js
</span><span class='line'>âââ node_modules
</span><span class='line'>âÂ Â  âââ ffi
</span><span class='line'>âââ src
</span><span class='line'>âÂ Â  âââ nanomsg.coffee
</span><span class='line'>âââ test
</span><span class='line'>    âââ test.coffee
</span><span class='line'>
</span><span class='line'>5 directories, 4 files
</span></code></pre></td></tr></table></div></figure>


<p>At this point, if we add features and want to rerun our tests, we need to
execute:</p>

<p><code>coffee -o lib -c src/nanomsg.coffee &amp;&amp; coffee test/test.coffee</code></p>

<p>While this command is simple now and easy to reverse search, anyone else
contributing to you project is going to have to know the commands to run the
tests.  Let&rsquo;s use
<a href="http://gruntjs.com/">Grunt</a>,
the JavaScript task runner, to automate our build and test process.</p>

<h2>Add a Build script</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>npm install -g grunt-cli &amp;&amp; \
</span><span class='line'>npm install grunt-contrib-coffee
</span></code></pre></td></tr></table></div></figure>


<p>Create a simple Gruntfile which can also be written in CoffeeScript:</p>

<figure class='code'><figcaption><span>Gruntfile.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">module.exports = </span><span class="nf">(grunt) -&gt;</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span>
</span><span class='line'>    <span class="nv">coffee:</span>
</span><span class='line'>      <span class="nv">compile:</span>
</span><span class='line'>        <span class="nv">files:</span>
</span><span class='line'>          <span class="s">&#39;lib/nanomsg.js&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s">&#39;src/*.coffee&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-coffee&#39;</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;coffee&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running <code>grunt</code> builds our lib which is a start, so let&rsquo;s
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/293e7378225c761ec496d9dcd09e1f2d331628a2">commit</a>
that.</p>

<p>But <code>grunt</code> is not running our tests.  And our tests don&rsquo;t have nice output.
Let&rsquo;s change that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>npm install -g mocha &amp;&amp; \
</span><span class='line'>npm install chai grunt-mocha-test
</span></code></pre></td></tr></table></div></figure>


<p>edit test/test.coffee to:</p>

<figure class='code'><figcaption><span>test/test.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">assert = </span><span class="nx">require</span> <span class="s">&#39;assert&#39;</span>
</span><span class='line'><span class="nv">should = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;chai&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">()</span>
</span><span class='line'><span class="nv">nanomsg = </span><span class="nx">require</span> <span class="s">&#39;../lib/nanomsg.js&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">describe</span> <span class="s">&#39;nanomsg&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">it</span> <span class="s">&#39;should at least work&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="p">{</span> <span class="nx">AF_SP</span><span class="p">,</span> <span class="nx">NN_PAIR</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">nanomsg</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">s1 = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_socket</span> <span class="nx">AF_SP</span><span class="p">,</span> <span class="nx">NN_PAIR</span>
</span><span class='line'>    <span class="nx">s1</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">at</span><span class="p">.</span><span class="nx">least</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_bind</span> <span class="nx">s1</span><span class="p">,</span> <span class="s">&#39;inproc://a&#39;</span>
</span><span class='line'>    <span class="nx">ret</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">above</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">s2 = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_socket</span> <span class="nx">AF_SP</span><span class="p">,</span> <span class="nx">NN_PAIR</span>
</span><span class='line'>    <span class="nx">s2</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">at</span><span class="p">.</span><span class="nx">least</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_connect</span> <span class="nx">s2</span><span class="p">,</span> <span class="s">&#39;inproc://a&#39;</span>
</span><span class='line'>    <span class="nx">ret</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">above</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">msg = </span><span class="k">new</span> <span class="nx">Buffer</span> <span class="s">&#39;hello&#39;</span>
</span><span class='line'>    <span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_send</span> <span class="nx">s2</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>    <span class="nx">ret</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">above</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">recv = </span><span class="k">new</span> <span class="nx">Buffer</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span>
</span><span class='line'>    <span class="nv">ret = </span><span class="nx">nanomsg</span><span class="p">.</span><span class="nx">nn_recv</span> <span class="nx">s1</span><span class="p">,</span> <span class="nx">recv</span><span class="p">,</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>    <span class="nx">ret</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">above</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">msg</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">should</span><span class="p">.</span><span class="nx">equal</span> <span class="nx">recv</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>and modify your gruntfile to add a testing step:</p>

<figure class='code'><figcaption><span>Gruntfile.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">module.exports = </span><span class="nf">(grunt) -&gt;</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span>
</span><span class='line'>    <span class="nv">coffee:</span>
</span><span class='line'>      <span class="nv">compile:</span>
</span><span class='line'>        <span class="nv">files:</span>
</span><span class='line'>          <span class="s">&#39;lib/nanomsg.js&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s">&#39;src/*.coffee&#39;</span><span class="p">]</span>
</span><span class='line'>    <span class="nv">mochaTest:</span>
</span><span class='line'>      <span class="nv">options:</span>
</span><span class='line'>        <span class="nv">reporter: </span><span class="s">&#39;nyan&#39;</span>
</span><span class='line'>      <span class="nv">src: </span><span class="p">[</span><span class="s">&#39;test/test.coffee&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-contrib-coffee&#39;</span>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span> <span class="s">&#39;grunt-mocha-test&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span> <span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;coffee&#39;</span><span class="p">,</span> <span class="s">&#39;mochaTest&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now when we run <code>grunt</code>, our build process will run, then our test process,
then we should see one incredibly happy
<a href="http://www.nyan.cat/">nyan cat</a>.
The
<a href="http://visionmedia.github.io/mocha/#reporters">nyan cat mocha test reporter</a>
is basically the pinnacle of human intellectual achievement.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>grunt
</span><span class='line'>Running &quot;coffee:compile&quot; (coffee) task
</span><span class='line'>File lib/nanomsg.js created.
</span><span class='line'>
</span><span class='line'>Running &quot;mochaTest:src&quot; (mochaTest) task
</span><span class='line'> 1   -__,------,
</span><span class='line'> 0   -__|  /\_/\
</span><span class='line'> 0   -_~|_( ^ .^)
</span><span class='line'>     -_ &quot;&quot;  &quot;&quot;
</span><span class='line'>
</span><span class='line'>  1 passing (5 ms)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://github.com/nickdesaulniers/node-nanomsg/commit/a43bcb3f69ca20bb1902472ecc954317e5fe0fe3">Commit time</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>tree -L 2 -C -a -I &#39;.git&#39;
</span><span class='line'>.
</span><span class='line'>âââ .gitignore
</span><span class='line'>âââ Gruntfile.coffee
</span><span class='line'>âââ lib
</span><span class='line'>âÂ Â  âââ nanomsg.js
</span><span class='line'>âââ node_modules
</span><span class='line'>âÂ Â  âââ ffi
</span><span class='line'>âÂ Â  âââ grunt
</span><span class='line'>âÂ Â  âââ grunt-contrib-coffee
</span><span class='line'>âââ src
</span><span class='line'>âÂ Â  âââ nanomsg.coffee
</span><span class='line'>âââ test
</span><span class='line'>    âââ test.coffee
</span><span class='line'>
</span><span class='line'>7 directories, 5 files
</span></code></pre></td></tr></table></div></figure>


<h2>Create node module</h2>

<p>Now that we have a more modular design with build and test logic built in,
let&rsquo;s make this module redistributable.  First, let&rsquo;s talk about ignoring
files.  Create a <code>.npmignore</code> file that will specify what not to include in the
module that is downloaded.  Node Package Manager,
<a href="https://npmjs.org/">npm</a>,
will
<a href="https://npmjs.org/doc/developers.html#Keeping-files-out-of-your-package">ignore a bunch of files by default</a>
for us.</p>

<figure class='code'><figcaption><span>.npmignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>Gruntfile.coffee
</span><span class='line'>src/
</span><span class='line'>test/
</span></code></pre></td></tr></table></div></figure>


<p>Here we&rsquo;re ignoring the <code>src/</code> dir, where in our <code>.gitignore</code> we are going to
ignore <code>lib/</code>.</p>

<figure class='code'><figcaption><span>.gitignore</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>node_modules/
</span><span class='line'>lib/
</span><span class='line'>*.swp
</span></code></pre></td></tr></table></div></figure>


<p>Why are we doing this?  Admittedly, none of this is strictly necessary, but
here&rsquo;s why I think it is useful.  When someone is checking out the source, they
don&rsquo;t need the results of the compilation step, as they can make modifications
and would need to recompile anyways.  Adding <code>lib/nanomsg.js</code> would just be
another thing to download (though its size is relatively insignificant).
Likewise, when someone downloads the module, they most likely just want the
results of the compilation step, not the source, build script, or test suite.
If I was planned on making the compiled JavaScript accessible to a web browser,
I would not add <code>lib/</code> to <code>.gitignore</code>, that way it could be referenced from the
github raw URL.
Again, these are generalizations that are not always true.  To make up for not
having the entire source when installed as a module, we&rsquo;ll make up for it by
adding a link to the repo from of manifest, but first let&rsquo;s
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/61458d964eaaee2ae6501bfbd186a1fe0d03d827">commit</a>!</p>

<p>Time to create a manifest file that has some basic info about our app.  It&rsquo;s a
pretty good idea to run <code>npm search &lt;packagename&gt;</code> before hand to make sure
your planned package name is not taken.  Since we have all of our dependencies
in a row, let&rsquo;s run
<code>npm init</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>This utility will walk you through creating a package.json file.
</span><span class='line'>It only covers the most common items, and tries to guess sane defaults.
</span><span class='line'>
</span><span class='line'>See `npm help json` for definitive documentation on these fields
</span><span class='line'>and exactly what they do.
</span><span class='line'>
</span><span class='line'>Use `npm install &lt;pkg&gt; --save` afterwards to install a package and
</span><span class='line'>save it as a dependency in the package.json file.
</span><span class='line'>
</span><span class='line'>Press ^C at any time to quit.
</span><span class='line'>name: (nanomsg)
</span><span class='line'>version: (0.0.0)
</span><span class='line'>description: nanomsg bindings
</span><span class='line'>entry point: (index.js) lib/nanomsg.js
</span><span class='line'>test command: grunt
</span><span class='line'>git repository: (git://github.com/nickdesaulniers/node-nanomsg.git)
</span><span class='line'>keywords: nanomsg
</span><span class='line'>author: Nick Desaulniers
</span><span class='line'>license: (BSD-2-Clause) Beerware
</span><span class='line'>About to write to /Users/Nicholas/code/c/nanomsg/package.json:
</span><span class='line'>
</span><span class='line'>{
</span><span class='line'>  &quot;name&quot;: &quot;nanomsg&quot;,
</span><span class='line'>  &quot;version&quot;: &quot;0.0.0&quot;,
</span><span class='line'>  &quot;description&quot;: &quot;nanomsg bindings&quot;,
</span><span class='line'>  &quot;main&quot;: &quot;lib/nanomsg.js&quot;,
</span><span class='line'>  &quot;directories&quot;: {
</span><span class='line'>    &quot;test&quot;: &quot;test&quot;
</span><span class='line'>  },
</span><span class='line'>  &quot;dependencies&quot;: {
</span><span class='line'>    &quot;chai&quot;: &quot;~1.7.2&quot;,
</span><span class='line'>    &quot;ffi&quot;: &quot;~1.2.5&quot;,
</span><span class='line'>    &quot;grunt&quot;: &quot;~0.4.1&quot;,
</span><span class='line'>    &quot;grunt-mocha-test&quot;: &quot;~0.6.3&quot;,
</span><span class='line'>    &quot;grunt-contrib-coffee&quot;: &quot;~0.7.0&quot;
</span><span class='line'>  },
</span><span class='line'>  &quot;devDependencies&quot;: {},
</span><span class='line'>  &quot;scripts&quot;: {
</span><span class='line'>    &quot;test&quot;: &quot;grunt&quot;
</span><span class='line'>  },
</span><span class='line'>  &quot;repository&quot;: {
</span><span class='line'>    &quot;type&quot;: &quot;git&quot;,
</span><span class='line'>    &quot;url&quot;: &quot;git://github.com/nickdesaulniers/node-nanomsg.git&quot;
</span><span class='line'>  },
</span><span class='line'>  &quot;keywords&quot;: [
</span><span class='line'>    &quot;nanomsg&quot;
</span><span class='line'>  ],
</span><span class='line'>  &quot;author&quot;: &quot;Nick Desaulniers&quot;,
</span><span class='line'>  &quot;license&quot;: &quot;Beerware&quot;,
</span><span class='line'>  &quot;bugs&quot;: {
</span><span class='line'>    &quot;url&quot;: &quot;https://github.com/nickdesaulniers/node-nanomsg/issues&quot;
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Is this ok? (yes)
</span></code></pre></td></tr></table></div></figure>


<p>That should create for us a nice package.json manifest file for npm.</p>

<p>We can now run our tests with the command <code>npm test</code> in addition to <code>grunt</code>.
Let&rsquo;s hold off on publishing just yet,
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/6ac3425005c69683df85f75c49e27c9cb634ada6">committing</a>
instead.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>tree -L 2 -C -a -I &#39;.git&#39;
</span><span class='line'>.
</span><span class='line'>âââ .gitignore
</span><span class='line'>âââ .npmignore
</span><span class='line'>âââ Gruntfile.coffee
</span><span class='line'>âââ lib
</span><span class='line'>âÂ Â  âââ nanomsg.js
</span><span class='line'>âââ node_modules
</span><span class='line'>âÂ Â  âââ .bin
</span><span class='line'>âÂ Â  âââ chai
</span><span class='line'>âÂ Â  âââ ffi
</span><span class='line'>âÂ Â  âââ grunt
</span><span class='line'>âÂ Â  âââ grunt-contrib-coffee
</span><span class='line'>âÂ Â  âââ grunt-mocha-test
</span><span class='line'>âââ package.json
</span><span class='line'>âââ src
</span><span class='line'>âÂ Â  âââ nanomsg.coffee
</span><span class='line'>âââ test
</span><span class='line'>    âââ test.coffee
</span><span class='line'>
</span><span class='line'>10 directories, 7 files
</span></code></pre></td></tr></table></div></figure>


<h2>Add LICENSE and README</h2>

<p>So we have a module that&rsquo;s almost ready to go.  But how will developers know
how to reuse this code?  As much as I like to
<em><a href="http://bartaz.github.io/impress.js/#/source">view the source, Luke</a></em>,
npm will complain without a readme.  The
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/95e5a7203740f8ab31758f54491d095567accf70">readme</a>
also looks nice on the github repo.</p>

<pre><code># Node-NanoMSG
Node.js binding for [nanomsg](http://nanomsg.org/index.html).

## Usage

`npm install nanomsg`

```javascript
var nanomsg = require('nanomsg');
var assert = require('assert');
var AF_SP = nanomsg.AF_SP;
var NN_PAIR = nanomsg.NN_PAIR;
var msg = new Buffer('hello');
var recv = new Buffer(msg.length);
var s1, s2, ret;

s1 = nanomsg.nn_socket(AF_SP, NN_PAIR);
assert(s1 &gt;= 0, 's1: ' + nanomsg.errno());

ret = nanomsg.nn_bind(s1, 'inproc://a');
assert(ret &gt; 0, 'bind');

s2 = nanomsg.nn_socket(AF_SP, NN_PAIR);
assert(s2 &gt;= 0, 's2: ' + nanomsg.errno());

ret = nanomsg.nn_connect(s2, 'inproc://a');
assert(ret &gt; 0, 'connect');

ret = nanomsg.nn_send(s2, msg, msg.length, 0);
assert(ret &gt; 0, 'send');

ret = nanomsg.recv(s1, recv, recv.length, 0);
assert(ret &gt; 0, 'recv');

assert(msg.toString() === recv.toString(), "didn't receive sent message");
console.log(recv.toString());
</code></pre>

<p>Before we publish, let&rsquo;s create a
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/48a55d0c51099f6b90cae5f190a8eb2b94140eae">license</a>
file, because though we are making
our code publicly viewable,
<a href="https://help.github.com/articles/open-source-licensing#what-happens-if-i-dont-choose-a-license">public source code without an explicit license is still under copyright and cannot be reused</a>.</p>

<figure class='code'><figcaption><span>LICENSE</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>/*
</span><span class='line'> * ----------------------------------------------------------------------------
</span><span class='line'> * &quot;THE BEER-WARE LICENSE&quot; (Revision 42):
</span><span class='line'> * &lt;nick@mozilla.com&gt; wrote this file. As long as you retain this notice you
</span><span class='line'> * can do whatever you want with this stuff. If we meet some day, and you think
</span><span class='line'> * this stuff is worth it, you can buy me a beer in return. Nick Desaulniers
</span><span class='line'> * ----------------------------------------------------------------------------
</span><span class='line'> */
</span></code></pre></td></tr></table></div></figure>


<p>If you want to be more serious, maybe instead shoot for an MIT or BSD style
license if you don&rsquo;t care what your repo gets used for or GPL style if you do.
<a href="http://www.tldrlegal.com/">TLDRLegal</a> has a great breakdown on common licenses.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>tree -L 2 -C -a -I &#39;.git&#39;
</span><span class='line'>.
</span><span class='line'>âââ .gitignore
</span><span class='line'>âââ .npmignore
</span><span class='line'>âââ Gruntfile.coffee
</span><span class='line'>âââ LICENSE
</span><span class='line'>âââ README.md
</span><span class='line'>âââ lib
</span><span class='line'>âÂ Â  âââ nanomsg.js
</span><span class='line'>âââ node_modules
</span><span class='line'>âÂ Â  âââ .bin
</span><span class='line'>âÂ Â  âââ chai
</span><span class='line'>âÂ Â  âââ ffi
</span><span class='line'>âÂ Â  âââ grunt
</span><span class='line'>âÂ Â  âââ grunt-contrib-coffee
</span><span class='line'>âÂ Â  âââ grunt-mocha-test
</span><span class='line'>âââ package.json
</span><span class='line'>âââ src
</span><span class='line'>âÂ Â  âââ nanomsg.coffee
</span><span class='line'>âââ test
</span><span class='line'>    âââ test.coffee
</span><span class='line'>
</span><span class='line'>10 directories, 9 files
</span></code></pre></td></tr></table></div></figure>


<h2>Publish</h2>

<p><code>npm publish</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>npm http PUT https://registry.npmjs.org/nanomsg
</span><span class='line'>npm http 201 https://registry.npmjs.org/nanomsg
</span><span class='line'>npm http GET https://registry.npmjs.org/nanomsg
</span><span class='line'>npm http 200 https://registry.npmjs.org/nanomsg
</span><span class='line'>npm http PUT https://registry.npmjs.org/nanomsg/-/nanomsg-0.0.0.tgz/-rev/1-20f1ec5ca2eed51e840feff22479bb5d
</span><span class='line'>npm http 201 https://registry.npmjs.org/nanomsg/-/nanomsg-0.0.0.tgz/-rev/1-20f1ec5ca2eed51e840feff22479bb5d
</span><span class='line'>npm http PUT https://registry.npmjs.org/nanomsg/0.0.0/-tag/latest
</span><span class='line'>npm http 201 https://registry.npmjs.org/nanomsg/0.0.0/-tag/latest
</span><span class='line'>+ nanomsg@0.0.0
</span></code></pre></td></tr></table></div></figure>


<p>Finally as a sanity check, I like to make a new folder elsewhere, and run
through the steps in the readme manually to make sure the package is reuseable.
Which is good, since in the readme I
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/c145d3b3a8e85354f1bfb61d8342531ec6bbaa0a">accidentally forgot</a>
the <code>nn_</code> prefix in
front of errno and recv!</p>

<p>After updating the example in the readme, let&rsquo;s
<a href="https://github.com/nickdesaulniers/node-nanomsg/commit/a6280ca85c4b9cbaac36f5b427bc052961d7e972">bump the version number</a>
and
republish.  Use <code>npm version</code> without arguments to find the current version,
then <code>npm version patch</code> to bump it.  You have to commit the readme changes
before bumping the version.  Finally don&rsquo;t forget to rerun <code>npm publish</code>.</p>

<p>Our
<a href="https://github.com/nickdesaulniers/node-nanomsg/tree/a6280ca85c4b9cbaac36f5b427bc052961d7e972">final directory structure</a>
ends up looking like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>tree -L 2 -C -a -I &#39;.git&#39;
</span><span class='line'>.
</span><span class='line'>âââ .gitignore
</span><span class='line'>âââ .npmignore
</span><span class='line'>âââ Gruntfile.coffee
</span><span class='line'>âââ LICENSE
</span><span class='line'>âââ README.md
</span><span class='line'>âââ lib
</span><span class='line'>âÂ Â  âââ nanomsg.js
</span><span class='line'>âââ node_modules
</span><span class='line'>âÂ Â  âââ .bin
</span><span class='line'>âÂ Â  âââ chai
</span><span class='line'>âÂ Â  âââ ffi
</span><span class='line'>âÂ Â  âââ grunt
</span><span class='line'>âÂ Â  âââ grunt-contrib-coffee
</span><span class='line'>âÂ Â  âââ grunt-mocha-test
</span><span class='line'>âââ package.json
</span><span class='line'>âââ src
</span><span class='line'>âÂ Â  âââ nanomsg.coffee
</span><span class='line'>âââ test
</span><span class='line'>    âââ test.coffee
</span><span class='line'>
</span><span class='line'>10 directories, 9 files
</span></code></pre></td></tr></table></div></figure>


<p>Lastly, I&rsquo;ll
<a href="https://github.com/250bpm/nanomsg/pull/122">reach out to</a>
Martin SÃºstrik and let him know that nanomsg has a new binding.</p>

<p>The bindings are far from complete, the test coverage could be better, and the
API is very C like and could use some OO syntactic sugar, but we&rsquo;re at a great
starting point and ready to rock and roll.  If you&rsquo;d like to help out, fork
<a href="https://github.com/nickdesaulniers/node-nanomsg.git">https://github.com/nickdesaulniers/node-nanomsg.git</a>.</p>

<p>What are some of your thoughts on build steps, testing, and directory layout of
node module?  This
tutorial was definitely not meant to be an authoritarian guide.  I look forward
to your comments on your experiences!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Nick Desaulniers</span></span>

      








  


<time datetime="2013-08-28T10:51:00-07:00" pubdate data-updated="true">Aug 28<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/250bpm/'>250bpm</a>, <a class='category' href='/blog/categories/coffeescript/'>coffeescript</a>, <a class='category' href='/blog/categories/directory/'>directory</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/martin/'>martin</a>, <a class='category' href='/blog/categories/module/'>module</a>, <a class='category' href='/blog/categories/nanomsg/'>nanomsg</a>, <a class='category' href='/blog/categories/node-dot-js/'>node.js</a>, <a class='category' href='/blog/categories/structure/'>structure</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://nickdesaulniers.github.io/blog/2013/08/28/making-great-node-dot-js-modules-with-coffeescript/" data-via="" data-counturl="http://nickdesaulniers.github.io/blog/2013/08/28/making-great-node-dot-js-modules-with-coffeescript/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/07/25/designated-initialization-with-pointers-in-c/" title="Previous Post: Designated initialization with compound literals in C">&laquo; Designated initialization with compound literals in C</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/09/26/function-dot-prototype-dot-bind-edge-cases/" title="Next Post: Function.prototype.bind Edge Cases">Function.prototype.bind Edge Cases &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/04/06/off-by-two/">Off by Two</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/05/12/f-vs-f-void-in-c-vs-c-plus-plus/">F() vs F(void) in C vs C++</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/18/finding-compiler-bugs-with-c-reduce/">Finding Compiler Bugs With C-Reduce</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/24/booting-a-custom-linux-kernel-in-qemu-and-debugging-it-with-gdb/">Booting a Custom Linux Kernel in QEMU and Debugging It With GDB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/06/02/speeding-up-linux-kernel-builds-with-ccache/">Speeding Up Linux Kernel Builds With Ccache</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/nickdesaulniers">@nickdesaulniers</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'nickdesaulniers',
            count: 20,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - Nick Desaulniers -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wangstabill';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://nickdesaulniers.github.io/blog/2013/08/28/making-great-node-dot-js-modules-with-coffeescript/';
        var disqus_url = 'http://nickdesaulniers.github.io/blog/2013/08/28/making-great-node-dot-js-modules-with-coffeescript/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
