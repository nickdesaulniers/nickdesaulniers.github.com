<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1,maximum-scale=1"><link href=/css/fonts.css rel=stylesheet type=text/css><title>Submitting Your First Patch to the Linux Kernel and Responding to Feedback</title><link rel=stylesheet href=/css/hugo-octopress.css><link rel=stylesheet href=https://nickdesaulniers.github.io/css/custom.css><link rel=stylesheet href=/css/fork-awesome.min.css><link href=https://nickdesaulniers.github.io/favicon.ico rel=icon><meta name=description content><meta name=keywords content><meta name=author content="Nick Desaulniers"><meta name=generator content="Hugo 0.109.0"></head><body><header role=banner><hgroup><h1><a href=https://nickdesaulniers.github.io/>Nick Desaulniers</a></h1><h2>The enemy's gate is down</h2></hgroup></header><nav role=navigation><fieldset class=mobile-nav><select onchange="location=this.value"><option value>Navigate…</option><option value=https://nickdesaulniers.github.io/about/>» About</option><option value=https://nickdesaulniers.github.io/blog/archives/>» Archives</option><option value=https://nickdesaulniers.github.io/>» Blog</option><option value=https://nickdesaulniers.github.io/publications/>» Publications</option><option value=https://nickdesaulniers.github.io/talks/>» Talks</option></select></fieldset><ul class=main-navigation><li><a href=https://nickdesaulniers.github.io/about/ title=About rel="noopener noreferrer">About</a></li><li><a href=https://nickdesaulniers.github.io/blog/archives/ title=Archives rel="noopener noreferrer">Archives</a></li><li><a href=https://nickdesaulniers.github.io/ title=Blog>Blog</a></li><li><a href=https://nickdesaulniers.github.io/publications/ title=Publications rel="noopener noreferrer">Publications</a></li><li><a href=https://nickdesaulniers.github.io/talks/ title=Talks rel="noopener noreferrer">Talks</a></li></ul><ul class=subscription><a href=https://nickdesaulniers.github.io/index.xml target=_blank type=application/rss+xml title=RSS rel="noopener noreferrer"><i class="fa fa-rss-square fa-lg"></i></a></ul><form action=https://www.google.com/search method=get target=_blank rel="noopener noreferrer"><fieldset role=search><input class=search type=text name=q results=0 placeholder=Search>
<input type=hidden name=q value=site:https://nickdesaulniers.github.io/></fieldset></form></nav><div id=main><div id=content><div><article class=hentry role=article><header><p class=meta>May 16, 2017
- 6 minute read
- <a href=https://nickdesaulniers.github.io/blog/2017/05/16/submitting-your-first-patch-to-the-linux-kernel-and-responding-to-feedback/#disqus_thread>Comments</a>
- <a class=label href=https://nickdesaulniers.github.io/categories/linux/>linux </a><a class=label href=https://nickdesaulniers.github.io/categories/patch/>patch </a><a class=label href=https://nickdesaulniers.github.io/categories/email/>email</a></p><h1 class=entry-title>Submitting Your First Patch to the Linux Kernel and Responding to Feedback</h1></header><div class=entry-content><p>After working on the Linux kernel for Nexus and Pixel phones for nearly a year,
and messing around with the
excellent
<a href=http://eudyptula-challenge.org/ target=_blank rel=noopener>Eudyptula challenge</a>, I finally
wanted to take a crack at submitting patches upstream to the Linux kernel.</p><p>This post is woefully inadequate compared to the existing documentation, which
should be preferred.</p><ul><li><a href=http://elixir.free-electrons.com/linux/latest/source/Documentation/process target=_blank rel=noopener>http://elixir.free-electrons.com/linux/latest/source/Documentation/process</a></li><li><a href=https://kernelnewbies.org/FirstKernelPatch target=_blank rel=noopener>https://kernelnewbies.org/FirstKernelPatch</a></li></ul><p>I figure I’d document my workflow, now that I’ve gotten a few patches accepted
(and so I can refer to this post rather than my shell history&mldr;). Feedback
welcome
(
<a href=https://github.com/nickdesaulniers/nickdesaulniers.github.com/issues target=_blank rel=noopener>open an issue</a>
or email me).</p><h2 id=step-1-setting-up-an-email-client>Step 1: Setting up an email client</h2><p>I mostly use <code>git send-email</code> for sending patch files. In my <code>~/.gitconfig</code> I
have added:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#719e07>[sendemail]</span>
</span></span><span style=display:flex><span>  <span style=color:#586e75>; setup for using git send-email; prompts for password</span>
</span></span><span style=display:flex><span>  smtpuser <span style=color:#719e07>=</span> <span style=color:#2aa198>myemailaddr@gmail.com
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  smtpserver = smtp.googlemail.com
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  smtpencryption = tls
</span></span></span><span style=display:flex><span><span style=color:#2aa198>  smtpserverport = 587</span>
</span></span></code></pre></div><p>To send patches through my gmail account. I don’t add my password so that I
don’t have to worry about it when I publish my dotfiles. I simply get prompted
every time I want to send an email.</p><p>I use
<a href=https://nickdesaulniers.github.io/blog/2016/06/18/mutt-gmail-ubuntu/ target=_blank rel=noopener>mutt</a>
to respond to threads when I <em>don&rsquo;t</em> have a patch to send.</p><h2 id=step-2-make-fixes>Step 2: Make fixes</h2><p>How do you find a bug to fix? My general approach to finding bugs in open
source C/C++ code bases has been using static analysis, a different compiler,
and/or more compiler warnings turned on. The kernel also has an instance of
<a href=https://bugzilla.kernel.org/describecomponents.cgi target=_blank rel=noopener>bugzilla</a>
running as an issue tracker. Work out of a new branch, in case you choose to
abandon it later. Rebase your branch before submitting (pull early, pull
often).</p><h2 id=step-3-thoughtful-commit-messages>Step 3: Thoughtful commit messages</h2><p>I always run <code>git log &lt;file I modified></code> to see some of the previous commit
messages on the file I modified.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ git log arch/x86/Makefile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>commit a5859c6d7b6114fc0e52be40f7b0f5451c4aba93
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>    x86/build: convert <span style=color:#719e07>function</span> graph <span style=color:#2aa198>&#39;-Os&#39;</span> error to warning
</span></span><span style=display:flex><span>commit 3f135e57a4f76d24ae8d8a490314331f0ced40c5
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>    x86/build: Mostly disable <span style=color:#2aa198>&#39;-maccumulate-outgoing-args&#39;</span>
</span></span></code></pre></div><p>The first words of commit messages in Linux are usually
<code>&lt;subsystem>/&lt;sub-subsystem>: &lt;descriptive comment></code>.</p><p>Let’s commit, <code>git commit &lt;files> -s</code>. We use the <code>-s</code> flag to <code>git commit</code> to
add our signoff. Signing your patches is standard and notes your agreement to
the
<a href=https://ltsi.linuxfoundation.org/developers/signed-process target=_blank rel=noopener>Linux Kernel Certificate of Origin</a>.</p><h2 id=step-4-generate-patch-file>Step 4: Generate Patch file</h2><p><code>git format-patch HEAD~</code>. You can use <code>git format-patch HEAD~&lt;number of commits to convert to patches></code> to turn multiple commits into patch files.
These patch files will be emailed to the
<a href=https://lkml.org/ target=_blank rel=noopener>Linux Kernel Mailing List (lkml)</a>.
They can be applied with <code>git am &lt;patchfile></code>. I like to back these files up
in another directory for future reference, and cause I still make a lot of
mistakes with git.</p><h2 id=step-5-checkpatch>Step 5: checkpatch</h2><p>You’re going to want to run the kernel’s linter before submitting. It will
catch style issues and other potential issues.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ./scripts/checkpatch.pl 0001-x86-build-don-t-add-maccumulate-outgoing-args-w-o-co.patch
</span></span><span style=display:flex><span>total: <span style=color:#2aa198>0</span> errors, <span style=color:#2aa198>0</span> warnings, <span style=color:#2aa198>9</span> lines checked
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>0001-x86-build-don-t-add-maccumulate-outgoing-args-w-o-co.patch has no obvious style problems and is ready <span style=color:#719e07>for</span> submission.
</span></span></code></pre></div><p>If you hit issues here, fix up your changes, update your commit with <code>git commit --amend &lt;files updated></code>, rerun format-patch, then rerun checkpatch
until you’re good to go.</p><h2 id=step-6-email-the-patch-to-yourself>Step 6: email the patch to yourself</h2><p>This is good to do when you’re starting off. While I use
<a href=https://nickdesaulniers.github.io/blog/2016/06/18/mutt-gmail-ubuntu/ target=_blank rel=noopener>mutt</a>
for responding to email, I use <code>git send-email</code> for sending patches. Once
you’ve gotten a hang of the workflow, this step is optional, more of a sanity
check.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ git send-email <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>0001-x86-build-require-only-gcc-use-maccumulate-outgoing-.patch
</span></span></code></pre></div><p>You don’t need to use command line arguments to cc yourself, assuming you set
up git correctly, git send-email should add you to the cc line as the author of
the patch. Send the patch just to yourself and make sure everything looks ok.</p><h2 id=step-7-fire-off-the-patch>Step 7: fire off the patch</h2><p>Linux is huge, and has a trusted set of maintainers for various subsystems.
The
<a href=http://elixir.free-electrons.com/linux/latest/source/MAINTAINERS target=_blank rel=noopener>MAINTAINERS file</a>
keeps track of these, but Linux has a tool to help you figure out where to send
your patch:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ ./scripts/get_maintainer.pl 0001-x86-build-don-t-add-maccumulate-outgoing-args-w-o-co.patch
</span></span><span style=display:flex><span>Person A &lt;person@a.com&gt; <span style=color:#719e07>(</span>maintainer:X86 ARCHITECTURE <span style=color:#719e07>(</span>32-BIT AND 64-BIT<span style=color:#719e07>))</span>
</span></span><span style=display:flex><span>Person B &lt;person@b.com&gt; <span style=color:#719e07>(</span>maintainer:X86 ARCHITECTURE <span style=color:#719e07>(</span>32-BIT AND 64-BIT<span style=color:#719e07>))</span>
</span></span><span style=display:flex><span>Person C &lt;person@c.com&gt; <span style=color:#719e07>(</span>maintainer:X86 ARCHITECTURE <span style=color:#719e07>(</span>32-BIT AND 64-BIT<span style=color:#719e07>))</span>
</span></span><span style=display:flex><span>x86@kernel.org <span style=color:#719e07>(</span>maintainer:X86 ARCHITECTURE <span style=color:#719e07>(</span>32-BIT AND 64-BIT<span style=color:#719e07>))</span>
</span></span><span style=display:flex><span>linux-kernel@vger.kernel.org <span style=color:#719e07>(</span>open list:X86 ARCHITECTURE <span style=color:#719e07>(</span>32-BIT AND 64-BIT<span style=color:#719e07>))</span>
</span></span></code></pre></div><p>With some additional flags, we can feed this output directly into
<code>git send-email</code>.</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ git send-email <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>--cc-cmd<span style=color:#719e07>=</span><span style=color:#2aa198>&#39;./scripts/get_maintainer.pl --norolestats 0001-my.patch&#39;</span> <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>--cc person@a.com <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>0001-my.patch
</span></span></code></pre></div><p>Make sure to cc yourself when prompted. Otherwise if you don’t subscribe to
LKML, then it will be difficult to reply to feedback. It’s also a good idea to
cc any other author that has touched this functionality recently.</p><h2 id=step-8-monitor-feedback>Step 8: monitor feedback</h2><p><a href=https://patchwork.kernel.org/project/LKML/list/ target=_blank rel=noopener>Patchwork</a>
for the LKML is a great tool for tracking the progress of patches. You should
register an account there. I highly recommend bookmarking your submitter
link. In Patchwork, click any submitter, then Filters (hidden in the top
left), change submitter to your name, click apply, then bookmark it.
<a href="https://patchwork.kernel.org/project/LKML/list/?submitter=Nick+Desaulniers" target=_blank rel=noopener>Here’s what mine looks like</a>.
Not much today, and mostly trivial patches, but hopefully this post won’t age
well in that regard.</p><p>Feedback may or may not be swift. I think my first patch I had to ping a
couple of times, but eventually got a response.</p><h2 id=step-9-responding-to-feedback>Step 9: responding to feedback</h2><p>Update your file, <code>git commit &lt;changed files> --amend</code> to update your latest
commit, <code>git format-patch -v2 HEAD~</code>, edit the patch
file to put the changes below the dash below the signed off lines
(
<a href=https://patchwork.kernel.org/patch/9720097/ target=_blank rel=noopener>example</a>), rerun checkpatch,
rerun get_maintainer if the files you modified changed since V1. Next, you
need to find the messageID to respond to the thread properly.</p><p>In gmail, when viewing the message I want to respond to, you can click “Show
Original” from the dropdown near the reply button. From there, copy the
MessageID from the top (everything in the angle brackets, but not the brackets
themselves). Finally, we send the patch:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ git send-email <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>--cc-cmd<span style=color:#719e07>=</span><span style=color:#2aa198>&#39;./scripts/get_maintainer.pl --norolestats 0001-my.patch&#39;</span> <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>--cc person@a.com <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>--in-reply-to 2017datesandletters@somehostname <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>0001-my.patch
</span></span></code></pre></div><p>We make sure to add anyone who may have commented on the patch from the mailing
list to keep them in the loop. Rinse and repeat 2 through 9 as desired until
patch is signed off/acked or rejected.</p><p>I&rsquo;ve added this handy shell function to my <code>~/.zshrc</code>:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#719e07>function</span> kpatch <span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
</span></span><span style=display:flex><span>  <span style=color:#268bd2>patch</span><span style=color:#719e07>=</span><span style=color:#268bd2>$1</span>
</span></span><span style=display:flex><span>  <span style=color:#b58900>shift</span>
</span></span><span style=display:flex><span>  git send-email <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>    --cc-cmd<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;./scripts/get_maintainer.pl --norolestats </span><span style=color:#268bd2>$patch</span><span style=color:#2aa198>&#34;</span> <span style=color:#cb4b16>\
</span></span></span><span style=display:flex><span><span style=color:#cb4b16></span>    <span style=color:#268bd2>$@</span> <span style=color:#268bd2>$patch</span>
</span></span><span style=display:flex><span><span style=color:#719e07>}</span>
</span></span></code></pre></div><p>That I can then invoke like:</p><div class=highlight><pre tabindex=0 style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kpatch 0001-Input-mousedev-fix-implicit-conversion-warning.patch --cc anyone@else.com
</span></span></code></pre></div><p>where <code>anyone@else.com</code> is anyone I want to add in additon to what
<code>get_maintainer</code> sugguests.</p><p>Finding out when your patch gets merged is a little tricky; each subsystem
maintainer seems to do things differently. My first patch, I didn’t know it
went in until a bot at Google notified me. The maintainers for the second and
third patches had bots notify me that it got merged into their trees, but when
they send Linus a PR and when that gets merged isn’t immediately obvious.</p><p>It’s not like Github where everyone involved gets an email that a PR got merged
and the UI changes. While there’s pros and cons to having this fairly
decentralized process, and while it is kind of is git’s original designed-for
use case, I’d be remiss not to mention that I really miss Github. Getting your
first patch acknowledged and even merged is
<a href=https://github.com/nickdesaulniers/What-Open-Source-Means-To-Me#what-open-source-means-to-me target=_blank rel=noopener>intoxicating and makes you want to contribute more</a>;
radio silence has the opposite effect.</p><p>Happy hacking!</p><p>(Thanks to Reddit user /u/EliteTK for pointing out that <code>-v2</code> was more concise
than <code>--subject-prefix="Patch vX"</code>).</p></div><footer><p class=meta><span class="byline author vcard">Posted by <span class=fn>Nick Desaulniers</span></span>
<time>May 16, 2017</time></span></p><p class=meta><a class="basic-alignment left" href=https://nickdesaulniers.github.io/blog/2016/11/20/static-and-dynamic-libraries/ title="Static and Dynamic Libraries">Static and Dynamic Libraries</a>
<a class="basic-alignment right" href=https://nickdesaulniers.github.io/blog/2017/05/31/running-clang-tidy-on-the-linux-kernel/ title="Running Clang-Tidy on the Linux Kernel">Running Clang-Tidy on the Linux Kernel</a></p><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wangstabill.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></footer></article></div><aside class="sidebar thirds"><section class="first odd"><p></p></section><ul class=sidebar-nav><li class=sidebar-nav-item><a target=_blank rel="noopener noreferrer" href=https://github.com/nickdesaulniers title=https://github.com/nickdesaulniers><i class="fa fa-github fa-3x"></i></a>
<a target=_blank rel="me noopener noreferrer" href=https://fosstodon.org/@llvm title=https://fosstodon.org/@llvm><i class="fa fa-mastodon fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/in/nick-desaulniers-75520334 title=https://www.linkedin.com/in/nick-desaulniers-75520334><i class="fa fa-linkedin fa-3x"></i></a>
<a target=_blank rel="noopener noreferrer" href=https://www.youtube.com/channel/UC68vgKSuS1Xjg9wpdvShfSQ title=https://www.youtube.com/channel/UC68vgKSuS1Xjg9wpdvShfSQ><i class="fa fa-youtube fa-3x"></i></a></li></ul><section class=even><h1>Recent Posts</h1><ul id=recent_posts><li class=post><a href=/blog/2023/03/10/disambiguating-arm/>Disambiguating Arm, Arm ARM, ARMv9, ARM9, ARM64, Aarch64, A64, A78, ...</a></li><li class=post><a href=/blog/2023/02/01/forking-is-not-free-the-hidden-costs/>Forking is not free; the hidden costs</a></li><li class=post><a href=/blog/2023/01/27/critical-edge-splitting/>Critical Edge Splitting</a></li><li class=post><a href=/blog/2023/01/20/debugging-wframe-larger-than/>Debugging -Wframe-larger-than=</a></li></ul></section></aside></div></div><footer role=contentinfo><p>Copyright &copy; 2023 Nick Desaulniers - <a href=https://nickdesaulniers.github.io/license/>License</a> -
<span class=credit>Powered by <a target=_blank href=https://gohugo.io rel="noopener noreferrer">Hugo</a> and <a target=_blank href=https://github.com/parsiya/hugo-octopress/ rel="noopener noreferrer">Hugo-Octopress</a> theme.</p></footer><script>var _gaq=[["_setAccount","UA-36993986-1"],["_trackPageview"]];(function(e,t){var n=e.createElement(t),s=e.getElementsByTagName(t)[0];n.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js",s.parentNode.insertBefore(n,s)})(document,"script")</script></body></html>